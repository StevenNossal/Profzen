<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset=utf-8 http-equiv="Content-Language" content="en"/>
		<title>Profzen Writer</title>
		<style type="text/css">
			
		</style>
	</head>
	<body>
		<h1>Prozen Writer</h1>
		<textarea id="writer-editor" class="writer-editor"></textarea>	
		
		<script>
			
			var socket_aw;
			
			document.addEventListener('DOMContentLoaded', function() {
				
			       
				try {
					socket_aw= new WebSocket(get_appropriate_ws_url(),"profzen-writer");
					socket_aw.onopen = function() {
						// alert("Socket Opened!");
					}	
					socket_aw.onmessage = function got_packet(msg) {
					}
					socket_aw.onclose = function() {
						// alert("Socket Closed!");
					}
				} catch(exception) {
					alert('<p>Error' + exception);
				}
				
				var writereditor = document.getElementById("writer-editor");
				writereditor.rows = 66;
				writereditor.cols = 80; 
				writereditor.onkeyup = function(){
					
					socket_aw.send(writereditor.value);	
				};


				function get_appropriate_ws_url()
				{
					var pcol;
					var u = document.URL;

					if (u.substring(0, 5) == "https") {
						pcol = "wss://";
						u = u.substr(8);
					} else {
						pcol = "ws://";
						if (u.substring(0,4) == "http")
						u = u.substr(7);
					}

					u = u.split('/');

					return pcol + u[0];
				}


		    	}, false);
		</script>
	</body>

</html>
